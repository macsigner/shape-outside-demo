<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Shape outside test</title>
    <style>
        .wrapper {
            position: relative;
            display: flex;
            height: var(--wrapper-height, auto);
            min-height: calc(100vh - 40px);
        }

        .wrapper::after {
            content: '';
            display: block;
            clear: both;
        }

        .text {
            background-color: rgba(0, 0, 0, .1);
            text-align: justify;
        }

        .text::after {
            content: '';
            display: block;
            clear: both;
        }

        .text::before {
            float: right;
            float: left;
            content: '';
            display: block;
            width: 100%;
            height: var(--wrapper-height, 0);
            shape-margin: 10px;
            shape-outside: polygon(100% 0%, 100% 100%, 0 100%);
            clip-path: polygon(100% 0%, 100% 100%, 0 100%);
            shape-outside: polygon(0 0, 100% 0, 0 100%);
            clip-path: polygon(0 0, 100% 0, 0 100%);
            background: red;
        }

        .text-inner > * {
            padding-left: 10px;
            padding-right: 10px;
        }
    </style>
</head>
<body>
<div class="wrapper">
    <main>
        <div class="text">
            <div class="text-inner">
                <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Corporis fuga maiores rerum odio doloremque
                    architecto neque aliquam consequuntur quo! Ipsam sunt aspernatur, autem cum similique perferendis itaque
                    ad repellat maiores. Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ullam, aut beatae! Rerum
                    illum voluptatibus autem sit est necessitatibus iste laborum, dolor incidunt tempora accusantium.
                    Corrupti veritatis sunt veniam dignissimos soluta quaerat voluptatem ipsum repudiandae quibusdam animi
                    nobis officiis earum cum minima laudantium adipisci explicabo aut, maxime enim doloremque nihil quasi
                    inventore atque. Exercitationem beatae adipisci, aperiam eius voluptatum nam vel optio iste unde porro
                    tenetur tempore cumque illum in id quia fugiat nostrum distinctio quibusdam quidem molestiae ipsa esse
                    facilis? Quam, molestiae possimus aspernatur fugiat velit ex nemo nobis aliquid, ipsam aperiam beatae
                    sit asperiores, commodi culpa ratione adipisci iure saepe itaque voluptas mollitia sint dicta minus.
                    Veritatis sunt minus doloribus, natus illum placeat exercitationem nostrum eum ipsa deleniti sed.</p>
                <p>Possimus provident, blanditiis accusantium cum dolorum cumque animi neque necessitatibus. Nobis quibusdam
                    voluptatibus porro necessitatibus, aut nesciunt ipsam corporis atque ducimus dicta delectus, perferendis
                    reprehenderit laboriosam quas, ipsa quo accusamus?</p>
                <p>Necessitatibus nemo laboriosam fugit aut, unde reiciendis modi adipisci quo porro corrupti ea enim
                    sapiente blanditiis, quas iste! Quae perferendis hic voluptate aut dolorum quasi quo similique vero quia
                    iusto. END.</p>
            </div>
        </div>
    </main>
    <script type="module">
        const wrapper = document.querySelector(".wrapper");
        let height = wrapper.offsetHeight;
        wrapper.style.setProperty("--wrapper-height", height + "px");

        function minHeight() {
            height = wrapper.scrollHeight - 10;
            while (wrapper.scrollHeight > height) {
                height++;
                console.log('calc');
                wrapper.style.setProperty("--wrapper-height", height + "px");
            }
        }

        minHeight();

        let resizeTimeout;
        function resize(e) {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                height = 0;
                wrapper.style.setProperty("--wrapper-height", height + 'px');
                minHeight();
            }, 800);
        }

        window.addEventListener("resize", resize);
        window.addEventListener("DOMContentLoaded", resize);
    </script>
</div>
</body>
</html>
